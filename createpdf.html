<form action="#" class="layui-form" id="fibrwcreate-form">
    <div class="layui-form-item">
        <div class="layui-inline">
            题目类型:
            <div class="layui-inline">
                <select name="type" id="typeselection">
                    <option value="1">C哥阅读下拉蓝色题目</option>
                    <option value="2">C哥阅读下拉黄色题目</option>
                    <option value="3">C哥阅读下拉白色题目</option>
                    <option value="4">C哥阅读下拉全部题目</option>
                    <option value="5">自定义阅读下拉题目1</option>
                    <option value="6">自定义阅读下拉题目2</option>
                </select>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label" style="color: red">可选选项:</label>
                <div class="layui-input-block">
                    <input type="checkbox" name="highlight" title="高亮答案" checked>
                    <input type="checkbox" name="needchinese" title="中文速记" checked>
                    <input type="checkbox" name="analysis" title="答案解析" checked>
                </div>
            </div>
            <button class="layui-btn" lay-header-event="createfibrwpdf">生成网页后通过浏览器的打印功能保存为pdf</button>
        </div>
    </div>
</form>
<br>
<br>
<br>
<br>

<form action="#" class="layui-form" id="fibrcreate-form">
    <div class="layui-form-item">
        <div class="layui-inline">
            题目类型:
            <div class="layui-inline">
                <select name="type">
                    <option value="1">C哥阅读拖拽蓝色题目</option>
                    <option value="2">C哥阅读拖拽黄色题目</option>
                    <option value="3">C哥阅读拖拽白色题目</option>
                    <option value="4">C哥阅读拖拽全部题目</option>
                    <option value="5">自定义阅读拖拽题目1</option>
                    <option value="6">自定义阅读拖拽题目2</option>
                </select>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label" style="color: red">可选选项:</label>
                <div class="layui-input-block">
                    <input type="checkbox" name="highlight" title="高亮答案" checked>
                </div>
            </div>
            <button class="layui-btn" lay-header-event="createfibrpdf">生成网页后通过浏览器的打印功能保存为pdf</button>
        </div>
    </div>
</form>
<br>
<br>
<br>
<br>

<form action="#" class="layui-form" id="fireflysstcreate-form">
    <div class="layui-form-item">
        <div class="layui-inline">
            题目类型:
            <div class="layui-inline">
                <select name="type" >
                    <option value="1">萤火虫SST高频</option>
                    <option value="2">萤火虫SST已整理题库</option>
                </select>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label" style="color: red">可选选项:</label>
                <div class="layui-input-block">
                    <input type="checkbox" name="simpleanswer" title="英文简单答案" checked>
                    <input type="checkbox" name="keyword" title="纯关键词" checked>
                    <input type="checkbox" name="chinese" title="中文速记" checked>
                </div>
            </div>
            <button class="layui-btn" lay-header-event="fireflysstcreatepdf">生成网页后通过浏览器的打印功能保存为pdf</button>
        </div>
    </div>
</form>


<script type="text/javascript">
    layui.use(['table', 'layer', 'form', 'util'], function () {
        var table = layui.table;
        var layer = layui.layer;
        var form = layui.form;
        var util = layui.util;
        fibrwInit();
        fibrInit();
        fireFlySSTInit();
        form.render();
        util.event('lay-header-event', {
            createfibrwpdf: function (obj, event) { // 左侧菜单事件
                event.preventDefault();
                var newPage = document.implementation.createHTMLDocument('New Page');
                // 在新文档中添加文本
                var head = newPage.head;
                // 获取当前URL
                var currentUrl = window.location.href;

                // 解析当前URL
                var urlParts = currentUrl.split('/');

            // 移除最后一部分，即当前文件或路径
                urlParts.pop();

                // 重新组合URL
                var parentUrl = urlParts.join('/');

                // 如果需要加上协议头和主机名，可以手动拼接
                if (parentUrl.charAt(parentUrl.length - 1) !== '/') {
                    parentUrl += '/';
                }
                console.log(parentUrl)
                // var params = JSON.stringify($("#fibrwcreate-form").serializeJson())
                var params = $("#fibrwcreate-form").serializeJson();
                var name = "C哥阅读下拉预测";
                switch (params.type) {
                    case "1":
                        name = "C哥阅读下拉蓝色题目";
                        break;

                    case "2":
                        name = "C哥阅读下拉黄色题目";
                        break;
                    case "3":
                        name = "C哥阅读下拉白色题目";
                        break;
                    case "4":
                        name = "C哥阅读下拉全部题目";
                        break;
                    case "5":
                        name = "自定义阅读下拉题目1";
                        break;
                    case "6":
                        name = "自定义阅读下拉题目2";
                        break;

                }
                head.innerHTML = "<meta charset=\"utf-8\">\n" +
                    "    <title>"+name+"</title>\n" +
                    "    <meta name=\"renderer\" content=\"webkit\">\n" +
                    "    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\">\n" +
                    "    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n" +
                    "    <link href=\"" + parentUrl + "css/layui.css\" rel=\"stylesheet\">\n" +
                    "    <style>\n" +
                    "        @font-face {\n" +
                    "            font-family: AaManYuShouXieTi;\n" +
                    "            src: url('https://gitee.com/api/v5/repos/jackiechan/ptepractise/contents/font/AaManYuShouXieTi3.ttf?access_token=2fd4d53480c117fa597505cebeceee9d');\n" +
                    "        }\n" +
                    "    </style>";
                var body = newPage.body;

                var currentTypedataList = fibRwCurrentTypedata(params);
                currentTypedataList.forEach(function (item, index) {
                    //生成内容数据,添加到网页中
                    var questionHtml = createFibRwPdfHtml(params, (index + 1), item);
                    $(body).append(questionHtml);
                })
               // body.innerHTML = "ceshi neirong";

                // 打开新页面并写入内容
                var newWindow = window.open('', '_blank');
                newWindow.document.write(newPage.documentElement.outerHTML);
                newWindow.document.close();
                return false;
            },
            createfibrpdf: function (obj,event){
                event.preventDefault();
                var newPage = document.implementation.createHTMLDocument('New Page');
                var head = newPage.head;
                // 获取当前URL
                var currentUrl = window.location.href;
                // 解析当前URL
                var urlParts = currentUrl.split('/');
                // 移除最后一部分，即当前文件或路径
                urlParts.pop();
                // 重新组合URL
                var parentUrl = urlParts.join('/');
                // 如果需要加上协议头和主机名，可以手动拼接
                if (parentUrl.charAt(parentUrl.length - 1) !== '/') {
                    parentUrl += '/';
                }
                console.log(parentUrl)
                //   var params = JSON.stringify($("#fibrcreate-form").serializeJson())
                var params = $("#fibrcreate-form").serializeJson();
                var name = "C哥阅读拖拽预测";
                switch (params.type) {
                    case "1":
                        name = "C哥阅读拖拽蓝色题目";
                        break;

                    case "2":
                        name = "C哥阅读拖拽黄色题目";
                        break;
                    case "3":
                        name = "C哥阅读拖拽白色题目";
                        break;
                    case "4":
                        name = "C哥阅读拖拽全部题目";
                        break;
                    case "5":
                        name = "自定义阅读拖拽题目1";
                        break;
                    case "6":
                        name = "自定义阅读拖拽题目2";
                        break;

                }
                head.innerHTML = "<meta charset=\"utf-8\">\n" +
                    "    <title>"+name+"</title>\n" +
                    "    <meta name=\"renderer\" content=\"webkit\">\n" +
                    "    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\">\n" +
                    "    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n" +
                    "    <link href=\"" + parentUrl + "css/layui.css\" rel=\"stylesheet\">\n" +
                    "    <style>\n" +
                    "        @font-face {\n" +
                    "            font-family: AaManYuShouXieTi;\n" +
                    "            src: url('https://gitee.com/api/v5/repos/jackiechan/ptepractise/contents/font/AaManYuShouXieTi3.ttf?access_token=2fd4d53480c117fa597505cebeceee9d');\n" +
                    "        }\n" +
                    "    </style>";
                var body = newPage.body;

                var currentTypedataList = fibRCurrentTypedata(params);
                currentTypedataList.forEach(function (item, index) {
                    //生成内容数据,添加到网页中
                    var questionHtml = createFibRPdfHtml(params, (index + 1), item);
                    $(body).append(questionHtml);
                })
                // body.innerHTML = "ceshi neirong";

                // 打开新页面并写入内容
                var newWindow = window.open('', '_blank');
                newWindow.document.write(newPage.documentElement.outerHTML);
                newWindow.document.close();
                return false;
            },
            fireflysstcreatepdf: function (obj,event){
                event.preventDefault();
                var newPage = document.implementation.createHTMLDocument('New Page');
                var head = newPage.head;
                // 获取当前URL
                var currentUrl = window.location.href;
                // 解析当前URL
                var urlParts = currentUrl.split('/');
                // 移除最后一部分，即当前文件或路径
                urlParts.pop();
                // 重新组合URL
                var parentUrl = urlParts.join('/');
                // 如果需要加上协议头和主机名，可以手动拼接
                if (parentUrl.charAt(parentUrl.length - 1) !== '/') {
                    parentUrl += '/';
                }
                console.log(parentUrl)
                //   var params = JSON.stringify($("#fibrcreate-form").serializeJson())
                var params = $("#fireflysstcreate-form").serializeJson();
                var name = "萤火虫sst预测";
                switch (params.type) {
                    case "1":
                        name = "萤火虫SST高频预测";
                        break;

                    case "2":
                        name = "萤火虫SST已整理预测";
                        break;
                }
                head.innerHTML = "<meta charset=\"utf-8\">\n" +
                    "    <title>"+name+"</title>\n" +
                    "    <meta name=\"renderer\" content=\"webkit\">\n" +
                    "    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\">\n" +
                    "    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n" +
                    "    <link href=\"" + parentUrl + "css/layui.css\" rel=\"stylesheet\">\n" +
                    "    <style>\n" +
                    "        @font-face {\n" +
                    "            font-family: AaManYuShouXieTi;\n" +
                    "            src: url('https://gitee.com/api/v5/repos/jackiechan/ptepractise/contents/font/AaManYuShouXieTi3.ttf?access_token=2fd4d53480c117fa597505cebeceee9d');\n" +
                    "        }\n" +
                    "    </style>";
                var body = newPage.body;

                var currentTypedataList = fireflySSTCurrentTypedata(params);
                currentTypedataList.forEach(function (item, index) {
                    //生成内容数据,添加到网页中
                    var questionHtml = createFireFlySSTPdfHtml(params, (index + 1), item);
                    $(body).append(questionHtml);
                })
                // body.innerHTML = "ceshi neirong";

                // 打开新页面并写入内容
                var newWindow = window.open('', '_blank');
                newWindow.document.write(newPage.documentElement.outerHTML);
                newWindow.document.close();
                return false;
            }
        })
    });
    $.fn.serializeJson = function () {
        var serializeObj = {};
        var array = this.serializeArray();
        $.each(array, function () {
            if (serializeObj[this.name] !== undefined) {
                if (!serializeObj[this.name].push) {
                    serializeObj[this.name] = [serializeObj[this.name]];
                }
                serializeObj[this.name].push(this.value || '');
            } else {
                serializeObj[this.name] = this.value || '';
            }
        });
        return serializeObj;
    };

</script>

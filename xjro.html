<form action="#" class="layui-form" id="xjrosearch-form">
    <div class="layui-form-item">
        <div class="layui-inline">
            <label>题号:</label>
            <div class="layui-inline">
                <input id="xjroNumInput" type="number" name="qNum" autocomplete="off" placeholder="请输入题号"
                       class="layui-input">
            </div>
            类型:
            <div class="layui-inline">
                <select name="type" id="xjrotypeselection">
                    <option value="1">C哥阅读RO蓝色题目</option>
                    <option value="2">C哥阅读RO黄色题目</option>
                    <option value="3">C哥阅读RO白色题目</option>
                    <option value="4">C哥阅读RO全部题目</option>
                    <option value="5">自定义题目1</option>
                    <option value="6">自定义题目2</option>
                    <option value="8">⭐️阅读RO月预测除C哥预测其他题</option>
                    <option value="7">阅读RO收藏夹</option>

                </select>
            </div>
            <button class="layui-btn" lay-header-event="xjrosearch">先点这里加载(搜索)题目</button>
        </div>
    </div>
</form>

<form class="layui-form" action="" id="question-form">
    <div id="question-div" style="padding-left: 20px;padding-right: 20px;line-height: 30px;font-size: large"></div>

    <div class="layui-form-item">
        <div class="layui-input-block" style="padding-top: 30px">
            <button type="submit" class="layui-btn" lay-submit lay-header-event="checkanswer" lay-filter="demo1"
                    hidden="hidden">
                检查答案
            </button>
            <button class="layui-btn" id="pre" lay-header-event="pre" hidden="hidden">上一题</button>
            <button class="layui-btn" id="next" lay-header-event="next" hidden="hidden">下一题</button>
            <button class="layui-btn" id="showanswer" lay-header-event="showanswer" hidden="hidden">显示/隐藏答案
                <button class="layui-btn" id="adddeletefav" lay-header-event="adddeletefav" hidden="hidden">添加到收藏
                </button>
                <div class="layui-inline" id="gotoarea">
                    <div class="layui-input-inline" style="width: 100px;">
                        <input type="number" id="qindex" name="price_min" placeholder="第几题" autocomplete="off"
                               class="layui-input" min="0" step="1" lay-affix="number">
                    </div>
                    <div class="layui-input-inline" style="width: 100px;">
                        <button class="layui-btn" id="gotoindex" lay-header-event="gotoindex">跳转</button>
                    </div>
                    <div class="layui-input-inline" id="rightandfalt" style="justify-content: center;vertical-align: middle;align-items: center;">

                    </div>
                </div>
        </div>

    </div>
</form>
<div class="layui-form-item" id="xjroanswer">
<pre class="layui-code answer-area" lay-options="{}" id="answer-area" style="font-size: 18px;font-family: Arial">
</pre>
</div>

<div class="layui-inline">

    <div class="layui-inline" style="width: 45%" id="">
        <div>
            <input value="11111" disabled>
        </div>
        <div>
            <input value="2" disabled>
        </div>
        <div>
            <input value="3" disabled>
        </div>

    </div>
    <div class="layui-inline" style="width: 45%; margin-left: 8%">

        <div>
            <input value="11111" disabled>
        </div>
        <div>
            <input value="2" disabled>
        </div>
        <div>
            <input value="3" disabled>
        </div>
    </div>


</div>

<script type="text/javascript">
    var localStorageType = "fibrw";
    layui.use(['table', 'layer', 'form', 'util'], function () {
        var table = layui.table;
        var layer = layui.layer;
        var form = layui.form;
        var util = layui.util;
        xjroInit();
        form.render();
        $("#xjroanswer").hide();
        util.event('lay-header-event', {
            xjrosearch: function (obj, event) { // 左侧菜单事件
                //  var json = JSON.stringify($("#xjrosearch-form").serializeJson())
                // alert("aaaaa" + json)
                event.preventDefault();
                $("#pre").hide();
                // var content = fibRwGetdata($("#xjrosearch-form").serializeJson());
                xjroCurrentTypedata($("#xjrosearch-form").serializeJson())
                var xjrodata = currentXjRoData();
                if (!xjrodata) {
                    $("#question-form").hide();
                    layer.msg('当前分类下不存在该题目', {icon: 0}, function () {
                        // layer.msg('提示框关闭后的回调');
                    });
                    return false;
                } else {
                    $("#question-form").show();
                }
                var content = xjroTranslateData(xjrodata);
                $("#question-div").html(content);
                fillAnswer(xjrodata);
                if (isXjRoLast()) {
                    $("#next").hide();
                } else {
                    $("#next").show();
                }
                if (getXjRoTotalNum() == 1) {
                    $("#gotoarea").hide();
                } else {
                    $("#gotoarea").show();
                }
                checkFav(xjrodata.num, localStorageType);
                form.render();
                return false;
            },
            next: function (obj, event) {
                var result = nextXjRoQuestion(obj, event,localStorageType);

                form.render();
                return result;
            },
            pre: function (obj, event) {
                event.preventDefault();
                if (isXjRoFirst()) {
                    $("#pre").hide();
                    return false;
                }

                var xjrodata = xjroPreQuest();
                var content = xjroTranslateData(xjrodata);
                if (isXjRoFirst()) {
                    $("#pre").hide();
                }
                if (!isXjRoLast()) {
                    $("#next").show();
                }
                $("#question-div").html(content);
                fillAnswer(xjrodata);
                checkFav(xjrodata.num, localStorageType);
                form.render();
                return false;
            },
            checkanswer: function (obj, event) {
                event.preventDefault();
                var xjrodata = currentXjRoData();
                var content = JSON.stringify($("#question-form").serializeJson());
                var result = $("#question-form").serializeJson();
                var isWrong = false;
                for (var ans in result) {
                    if (!ans || !ans.startsWith("answer")) {
                        continue;
                    }
                    console.log(result[ans]);
                    var answer = result[ans];
                    var select = $("#" + ans);
                    console.log($(select))
                    if (!answer || answer.startsWith("false")) {
                        // $(allSelects[i]).addClass("layui-form-danger");
                        $(select).removeClass();
                        $(select).attr("class", "layui-form-danger");
                        isWrong = true;
                    }

                }
                if (!isWrong) {
                    addRightOrFalt(xjrodata.num, "right", localStorageType);
                    layer.msg('全部正确,考试必过!', {icon: 0, time: 800}, function () {
                        //添加正确次数,添加错误次数
                        // layer.msg('提示框关闭后的回调');
                        if (!isXjRoLast()) {
                            nextXjRoQuestion(obj, event,localStorageType);
                            form.render();
                        }
                    });
                } else {
                    addRightOrFalt(xjrodata.num, "falt", localStorageType);
                    layer.msg('答案不小心选错了哟!', {icon: 0}, function () {
                        // layer.msg('提示框关闭后的回调');
                        //添加错误次数
                    });
                }
                setRightAndFaltNum(xjrodata.num, localStorageType);
            },
            showanswer: function (obj, event) {
                event.preventDefault();
                if ($("#xjroanswer").is(":hidden")) {
                    $("#xjroanswer").show();
                } else {
                    $("#xjroanswer").hide();
                }
            },
            gotoindex: function (obj, event) {
                event.preventDefault();
                var qIndex = $("#qindex").val();//想要跳转的题目
                console.log(qIndex);
                if (!qIndex || qIndex <= 0 || qIndex > getXjRoTotalNum) {

                } else {
                    setXjRoIndex(parseInt(qIndex));
                    var xjrodata = currentXjRoData();
                    if (!xjrodata) {
                        layer.msg('超出题目数量范围', {icon: 0}, function () {
                        });
                        return false;
                    }
                    var content = xjroTranslateData(xjrodata);
                    if (isXjRoFirst()) {
                        $("#pre").hide();
                    } else {
                        $("#pre").show();
                    }
                    if (!isXjRoLast()) {
                        $("#next").show();
                    } else {
                        $("#next").hide();
                    }
                    $("#question-div").html(content);
                    fillAnswer(xjrodata);
                    checkFav(xjrodata.num, localStorageType);
                    form.render();
                    return false;
                }


            },
            adddeletefav: function (obj, event) {
                event.preventDefault();


                var xjrodata = currentXjRoData();
                if (!xjrodata) {
                    layer.msg('题目无效', {icon: 0}, function () {
                    });
                    return false;
                }
                var isContains = containsValue(xjrodata.num, localStorageType);
                if (isContains) {
                    layer.confirm('是否删除收藏？', {icon: 3}, function () {
                        removeFromLocalStorage(xjrodata.num, localStorageType);
                        layer.msg('操作完成', {icon: 0}, function () {
                        });
                        checkFav(xjrodata.num, localStorageType);
                    }, function () {
                    });

                } else {
                    layer.confirm('是否添加到收藏？', {icon: 3}, function () {
                        add2LocalStorage("fibrwblue", xjrodata.num, localStorageType)
                        layer.msg('操作完成', {icon: 0}, function () {
                        });
                        checkFav(xjrodata.num, localStorageType);
                    }, function () {
                    });

                }

            }
        });
        // 自定义验证规则
        form.verify({
            answer: function (value) {

                if (value.startsWith("false")) {
                    return "答案不小心选错了哟";
                }
            }
        });
    })
    $.fn.serializeJson = function () {
        var serializeObj = {};
        var array = this.serializeArray();
        $.each(array, function () {
            if (serializeObj[this.name] !== undefined) {
                if (!serializeObj[this.name].push) {
                    serializeObj[this.name] = [serializeObj[this.name]];
                }
                serializeObj[this.name].push(this.value || '');
            } else {
                serializeObj[this.name] = this.value || '';
            }
        });
        return serializeObj;
    };
    function fillAnswer(xjrodata) {
        $("#xjroanswer").hide();
        var answerInText = xjrodata.answer_in_text;
        var originalText = xjrodata.originalText;
        var answercontent = "</br>" + "</br>" + answerInText + "</br>" + "</br>" + originalText;
        $("#xjroanswer").html(answercontent);
        setRightAndFaltNum(xjrodata.num, localStorageType);
    }

    function nextXjRoQuestion(obj, event,localStorageType) {
        event.preventDefault();
        if (isXjRoLast()) {
            $("#next").hide();
            return false;
        }

        var xjrodata = xjroNextQuest();
        var content = xjroTranslateData(xjrodata);
        if (isXjRoLast()) {
            $("#next").hide();
        }
        $("#question-div").html(content);
        fillAnswer(xjrodata);
        if (!isXjRoFirst()) {
            $("#pre").show();
        }
        checkFav(xjrodata.num, localStorageType);
        return false;
    }


</script>


